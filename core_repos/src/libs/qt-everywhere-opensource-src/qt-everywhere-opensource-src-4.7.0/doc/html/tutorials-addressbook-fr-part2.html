<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- addressbook-fr.qdoc -->
  <title>Qt 4.7: Carnet d'adresses 2 - Ajouter des adresses</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
		<div id="narrowsearch"><form onsubmit="return false;" action="" id="qtdocsearch">
		<fieldset>
		<input type="text" value="" id="pageType2" name="searchstring"/>
		 </fieldset>
		</form></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global stuff</a></li> 
			   <li><a href="qdeclarativeelements.html">QML elements</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Basic Qt architecture</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">Desktop UI components</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li><a href="examples-tutorials.html"></a></li>              <li>Carnet d'adresses 2 - Ajouter des adresses</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#d-finition-de-la-classe-addressbook">Définition de la classe AddressBook</a></li>
<li class="level1"><a href="#impl-mentation-de-la-classe-addressbook">Implémentation de la classe AddressBook</a></li>
</ul>
</div>
<h1 class="title">Carnet d'adresses 2 - Ajouter des adresses</h1>
<span class="subtitle"></span>
<!-- $$$tutorials/addressbook-fr/part2-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="tutorials-addressbook-fr-part2-addressbook-cpp.html">tutorials/addressbook-fr/part2/addressbook.cpp</a></li>
<li><a href="tutorials-addressbook-fr-part2-addressbook-h.html">tutorials/addressbook-fr/part2/addressbook.h</a></li>
<li><a href="tutorials-addressbook-fr-part2-main-cpp.html">tutorials/addressbook-fr/part2/main.cpp</a></li>
<li><a href="tutorials-addressbook-fr-part2-part2-pro.html">tutorials/addressbook-fr/part2/part2.pro</a></li>
</ul>
<p>La prochaine étape pour créer notre carnet d'adresses est d'ajouter un soupçon d'interactivité.</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-add-contact.png" /></p><p>Nous allons fournir un bouton que l'utilisateur peut cliquer pour ajouter un nouveau contact. Une structure de données est aussi nécessaire afin de pouvoir stocker les contacts en mémoire.</p>
<a name="d-finition-de-la-classe-addressbook"></a>
<h2>Définition de la classe AddressBook</h2>
<p>Maintenant que nous avons mis en place les labels et les champs de saisie, nous ajoutons les boutons pour compléter le processus d'ajout d'un contact. Cela veut dire que notre fichier <tt>addressbook.h</tt> a maintenant trois objets <a href="qpushbutton.html">QPushButton</a> et trois slots publics correspondant.</p>
<pre class="highlightedCode brush: cpp"> public slots:
     void addContact();
     void submitContact();
     void cancel();</pre>
<p>Un slot est une méthode qui répond à un signal. Nous allons voir ce concept en détail lorsque nous implémenterons la classe <tt>AddressBook</tt>. Pour une explication détaillée du concept de signal et slot, vous pouvez vous référer au document <a href="signalsandslots.html#signals-and-slots">Signals and Slots</a>.</p>
<p>Les trois objets <a href="qpushbutton.html">QPushButton</a> <tt>addButton</tt>, <tt>submitButton</tt> et <tt>cancelButton</tt> sont maintenant inclus dans la déclaration des variables privées, avec <tt>nameLine</tt> et <tt>addressText</tt> du chapitre précédent.</p>
<pre class="highlightedCode brush: cpp"> private:
     QPushButton *addButton;
     QPushButton *submitButton;
     QPushButton *cancelButton;
     QLineEdit *nameLine;
     QTextEdit *addressText;</pre>
<p>Nous avons besoin d'un conteneur pour stocker les contacts du carnet d'adresses, de façon à pouvoir les énumérer et les afficher. Un objet <a href="qmap.html">QMap</a>, <tt>contacts</tt>, est utilisé pour ça, car il permet de stocker des paires clé-valeur: le nom du contact est la <i>clé</i> et l'adresse du contact est la <i>valeur</i>.</p>
<pre class="highlightedCode brush: cpp">     QMap&lt;QString, QString&gt; contacts;
     QString oldName;
     QString oldAddress;
 };</pre>
<p>Nous déclarons aussi deux objects <a href="qstring.html">QString</a> privés: <tt>oldName</tt> et <tt>oldAddress</tt>. Ces objets sont nécessaires pour conserver le nom et l'adresse du dernier contact affiché avant que l'utilisateur ne clique sur le bouton &quot;Add&quot;. Grâce à ces variables si l'utilisateur clique sur &quot;Cancel&quot;, il est possible de revenir à l'affichage du dernier contact.</p>
<a name="impl-mentation-de-la-classe-addressbook"></a>
<h2>Implémentation de la classe AddressBook</h2>
<p>Dans le constructeur de <tt>AddressBook</tt>, <tt>nameLine</tt> et <tt>addressText</tt> sont mis en mode lecture seule, de façon à autoriser l'affichage mais pas la modification du contact courant.</p>
<pre class="highlightedCode brush: cpp">     ...
     nameLine-&gt;setReadOnly(true);
     ...
     addressText-&gt;setReadOnly(true);</pre>
<p>Ensuite, nous instancions les boutons <tt>addButton</tt>, <tt>submitButton</tt>, et <tt>cancelButton</tt>.</p>
<pre class="highlightedCode brush: cpp">     addButton = new QPushButton(tr(&quot;&amp;Add&quot;));
     addButton-&gt;show();
     submitButton = new QPushButton(tr(&quot;&amp;Submit&quot;));
     submitButton-&gt;hide();
     cancelButton = new QPushButton(tr(&quot;&amp;Cancel&quot;));
     cancelButton-&gt;hide();</pre>
<p>Le bouton <tt>addButton</tt> est affiché en invoquant la méthode <a href="qwidget.html#show">show()</a>, tandis que <tt>submitButton</tt> et <tt>cancelButton</tt> sont cachés en invoquant <a href="qwidget.html#hide">hide()</a>. Ces deux boutons ne seront affichés que lorsque l'utilisateur cliquera sur &quot;Add&quot;, et ceci est géré par la méthode <tt>addContact()</tt> décrite plus loin.</p>
<pre class="highlightedCode brush: cpp">     connect(addButton, SIGNAL(clicked()), this, SLOT(addContact()));
     connect(submitButton, SIGNAL(clicked()), this, SLOT(submitContact()));
     connect(cancelButton, SIGNAL(clicked()), this, SLOT(cancel()));</pre>
<p>Nous connectons le signal <a href="qabstractbutton.html#clicked">clicked()</a> de chaque bouton au slot qui gèrera l'action. L'image ci-dessous illustre ceci:</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-signals-and-slots.png" /></p><p>Ensuite, nous arrangeons proprement les boutons sur la droite du widget AddressBook, et nous utilisons un <a href="qvboxlayout.html">QVBoxLayout</a> pour les aligner verticalement.</p>
<pre class="highlightedCode brush: cpp">     QVBoxLayout *buttonLayout1 = new QVBoxLayout;
     buttonLayout1-&gt;addWidget(addButton, Qt::AlignTop);
     buttonLayout1-&gt;addWidget(submitButton);
     buttonLayout1-&gt;addWidget(cancelButton);
     buttonLayout1-&gt;addStretch();</pre>
<p>La methode <a href="qboxlayout.html#addStretch">addStretch()</a> est utilisée pour assurer que les boutons ne sont pas répartis uniformément, mais regroupés dans la partie supperieure du widget. La figure ci-dessous montre la différence si <a href="qboxlayout.html#addStretch">addStretch()</a> est utilisé ou pas.</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-stretch-effects.png" /></p><p>Ensuite nous ajoutons <tt>buttonLayout1</tt> à <tt>mainLayout</tt>, en utilisant <a href="qgridlayout.html#addLayout">addLayout()</a>. Ceci nous permet d'imbriquer les mises en page puisque <tt>buttonLayout1</tt> est maintenant un enfant de <tt>mainLayout</tt>.</p>
<pre class="highlightedCode brush: cpp">     QGridLayout *mainLayout = new QGridLayout;
     mainLayout-&gt;addWidget(nameLabel, 0, 0);
     mainLayout-&gt;addWidget(nameLine, 0, 1);
     mainLayout-&gt;addWidget(addressLabel, 1, 0, Qt::AlignTop);
     mainLayout-&gt;addWidget(addressText, 1, 1);
     mainLayout-&gt;addLayout(buttonLayout1, 1, 2);</pre>
<p>Les coordonnées du layout global ressemblent maintenant à ça:</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-labeled-layout.png" /></p><p>Dans la méthode <tt>addContact()</tt>, nous stockons les détails du dernier contact affiché dans <tt>oldName</tt> et <tt>oldAddress</tt>. Ensuite, nous vidons ces champs de saisie et nous désactivons le mode lecture seule. Le focus est placé sur <tt>nameLine</tt> et on affiche <tt>submitButton</tt> et <tt>cancelButton</tt>.</p>
<pre class="highlightedCode brush: cpp"> void AddressBook::addContact()
 {
     oldName = nameLine-&gt;text();
     oldAddress = addressText-&gt;toPlainText();

     nameLine-&gt;clear();
     addressText-&gt;clear();

     nameLine-&gt;setReadOnly(false);
     nameLine-&gt;setFocus(Qt::OtherFocusReason);
     addressText-&gt;setReadOnly(false);

     addButton-&gt;setEnabled(false);
     submitButton-&gt;show();
     cancelButton-&gt;show();
 }</pre>
<p>La méthode <tt>submitContact()</tt> peut être divisée en trois parties:</p>
<ol type="1">
<li>Nous extrayons les détails du contact depuis <tt>nameLine</tt> et <tt>addressText</tt> et les stockons dans des objets <a href="qstring.html">QString</a>. Nous les validons pour s'assurer que l'utilisateur n'a pas cliqué sur &quot;Add&quot; avec des champs de saisie vides; sinon un message est affiché avec <a href="qmessagebox.html">QMessageBox</a> pour rappeller à l'utilisateur que les deux champs doivent être complétés.<pre class="highlightedCode brush: cpp"> void AddressBook::submitContact()
 {
     QString name = nameLine-&gt;text();
     QString address = addressText-&gt;toPlainText();

     if (name.isEmpty() || address.isEmpty()) {
         QMessageBox::information(this, tr(&quot;Empty Field&quot;),
             tr(&quot;Please enter a name and address.&quot;));
         return;
     }</pre>
</li>
<li>Ensuite, nous vérifions si le contact existe déjà. Si aucun contacts existant n'entre en conflit avec le nouveau, nous l'ajoutons à <tt>contacts</tt> et nous affichons un <a href="qmessagebox.html">QMessageBox</a> pour informer l'utilisateur que le contact a été ajouté.<pre class="highlightedCode brush: cpp">     if (!contacts.contains(name)) {
         contacts.insert(name, address);
         QMessageBox::information(this, tr(&quot;Add Successful&quot;),
             tr(&quot;\&quot;%1\&quot; has been added to your address book.&quot;).arg(name));
     } else {
         QMessageBox::information(this, tr(&quot;Add Unsuccessful&quot;),
             tr(&quot;Sorry, \&quot;%1\&quot; is already in your address book.&quot;).arg(name));
         return;
     }</pre>
<p>Si le contact existe déjà, nous affichons un <a href="qmessagebox.html">QMessageBox</a> pour informer l'utilisateur du problème. Notre objet <tt>contacts</tt> est basé sur des paires clé-valeur formés par le nom et l'adresse, nous voulons nous assurer que la <i>clé</i> est unique.</p>
</li>
<li>Une fois que les deux vérifications précédentes ont été traitées, nous restaurons les boutons à leur état normal à l'aide du code suivant:<pre class="highlightedCode brush: cpp">     if (contacts.isEmpty()) {
         nameLine-&gt;clear();
         addressText-&gt;clear();
     }

     nameLine-&gt;setReadOnly(true);
     addressText-&gt;setReadOnly(true);
     addButton-&gt;setEnabled(true);
     submitButton-&gt;hide();
     cancelButton-&gt;hide();
 }</pre>
</li>
</ol>
<p>La capture d'écran ci-dessous montre l'affichage fournit par un objet <a href="qmessagebox.html">QMessageBox</a>, utilisé ici pour afficher un message d'information à l'utilisateur:</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-add-successful.png" /></p><p>La méthode <tt>cancel()</tt> restaure les détails du dernier contact, active <tt>addButton</tt>, et cache <tt>submitButton</tt> et <tt>cancelButton</tt>.</p>
<pre class="highlightedCode brush: cpp"> void AddressBook::cancel()
 {
     nameLine-&gt;setText(oldName);
     nameLine-&gt;setReadOnly(true);

     addressText-&gt;setText(oldAddress);
     addressText-&gt;setReadOnly(true);

     addButton-&gt;setEnabled(true);
     submitButton-&gt;hide();
     cancelButton-&gt;hide();
 }</pre>
<p>L'idée générale pour augmenter la flexibilité lors de l'ajout d'un contact est de donner la possiblité de cliquer sur &quot;Add&quot; ou &quot;Cancel&quot; à n'importe quel moment. L'organigramme ci-dessous reprend l'ensemble des interactions dévelopées jusqu'ici:</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part2-add-flowchart.png" /></p></div>
<!-- @@@tutorials/addressbook-fr/part2 -->
        <!-- /div -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback. <div class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</div></p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
  <!--/div -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4457116-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
