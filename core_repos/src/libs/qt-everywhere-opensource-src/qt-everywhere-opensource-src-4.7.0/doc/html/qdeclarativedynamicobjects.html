<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- dynamicobjects.qdoc -->
  <title>Qt 4.7: Dynamic Object Management in QML</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
		<div id="narrowsearch"><form onsubmit="return false;" action="" id="qtdocsearch">
		<fieldset>
		<input type="text" value="" id="pageType2" name="searchstring"/>
		 </fieldset>
		</form></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global stuff</a></li> 
			   <li><a href="qdeclarativeelements.html">QML elements</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Basic Qt architecture</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">Desktop UI components</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li>Dynamic Object Management in QML</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#creating-objects-dynamically">Creating Objects Dynamically</a></li>
<li class="level2"><a href="#creating-a-component-dynamically">Creating a Component dynamically</a></li>
<li class="level2"><a href="#creating-an-object-from-a-string-of-qml">Creating an object from a string of QML</a></li>
<li class="level1"><a href="#maintaining-dynamically-created-objects">Maintaining Dynamically Created Objects</a></li>
<li class="level1"><a href="#deleting-objects-dynamically">Deleting Objects Dynamically</a></li>
</ul>
</div>
<h1 class="title">Dynamic Object Management in QML</h1>
<span class="subtitle"></span>
<!-- $$$qdeclarativedynamicobjects.html-description -->
<div class="descr"> <a name="details"></a>
<p>QML provides a number of ways to dynamically create and manage QML objects. The <a href="qml-loader.html">Loader</a>, <a href="qml-repeater.html">Repeater</a>, <a href="qml-listview.html">ListView</a>, <a href="qml-gridview.html">GridView</a> and <a href="qml-pathview.html">PathView</a> elements all support dynamic object management. Objects can also be created and managed from C++, and this is the preferred method for hybrid QML/C++ applications (see <a href="qtbinding.html">Using QML in C++ Applications</a>).</p>
<p>QML also supports the dynamic creation of objects from within <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> code. This is useful if the existing QML elements do not fit the needs of your application, and there are no C++ components involved.</p>
<p>See the <a href="declarative-toys-dynamicscene.html">Dynamic Scene example</a> for a demonstration of the concepts discussed on this page.</p>
<a name="creating-objects-dynamically"></a>
<h2>Creating Objects Dynamically</h2>
<p>There are two ways to create objects dynamically from <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a>. You can either call <a href="qml-qt.html#createComponent-method">Qt.createComponent()</a> to dynamically create a <a href="qml-component.html">Component</a> object, or use <a href="qml-qt.html#createQmlObject-method">Qt.createQmlObject()</a> to create an item from a string of QML. Creating a component is better if you have an existing component defined in a <tt>.qml</tt> file, and you want to dynamically create instances of that component. Otherwise, creating an item from a string of QML is useful when the item QML itself is generated at runtime.</p>
<a name="creating-a-component-dynamically"></a>
<h3>Creating a Component dynamically</h3>
<p>To dynamically load a component defined in a QML file, call the <a href="qml-qt.html#createComponent-method">Qt.createComponent()</a> function on the <a href="qdeclarativeglobalobject.html">QML Global Object</a>. This function takes the URL of the QML file as its only argument and creates a <a href="qml-component.html">Component</a> object from this URL.</p>
<p>Once you have a <a href="qml-component.html">Component</a>, you can call its <a href="qml-component.html#createObject-method">createObject()</a> method to create an instance of the component. This function takes exactly one argument, which is the parent for the new item. Since graphical items will not appear on the scene without a parent, it is recommended that you set the parent this way. However, if you wish to set the parent later you can safely pass <tt>null</tt> to this function.</p>
<p>Here is an example. First there is <tt>Sprite.qml</tt>, which defines a simple QML component:</p>
<pre class="highlightedCode brush: cpp"> import Qt 4.7

 Rectangle { width: 80; height: 50; color: &quot;red&quot; }</pre>
<p>Our main application file, <tt>main.qml</tt>, imports a <tt>componentCreation.js</tt> <a href="https://developer.mozilla.org/en/JavaScript">JavaScript</a> file that will create <tt>Sprite</tt> objects:</p>
<pre class="highlightedCode brush: cpp"> import Qt 4.7
 import &quot;componentCreation.js&quot; as MyScript

 Rectangle {
     id: appWindow
     width: 300; height: 300

     Component.onCompleted: MyScript.createSpriteObjects();
 }</pre>
<p>Here is <tt>componentCreation.js</tt>. Notice it checks whether the component <a href="qml-component.html#status-prop">status</a> is <tt>Component.Ready</tt> before calling <a href="qml-component.html#createObject-method">createObject()</a> in case the QML file is loaded over a network and thus is not ready immediately.</p>
<pre class="highlightedCode brush: cpp"> var component;
 var sprite;

 function createSpriteObjects() {
     component = Qt.createComponent(&quot;Sprite.qml&quot;);
     if (component.status == Component.Ready)
         finishCreation();
     else
         component.statusChanged.connect(finishCreation);
 }

 function finishCreation() {
     if (component.status == Component.Ready) {
         sprite = component.createObject(appWindow);
         if (sprite == null) {
             // Error Handling
         } else {
             sprite.x = 100;
             sprite.y = 100;
             // ...
         }
     } else if (component.status == Component.Error) {
         // Error Handling
         console.log(&quot;Error loading component:&quot;, component.errorString());
     }
 }</pre>
<p>If you are certain the QML file to be loaded is a local file, you could omit the <tt>finishCreation()</tt> function and call <a href="qml-component.html#createObject-method">createObject()</a> immediately:</p>
<pre class="highlightedCode brush: cpp"> function createSpriteObjects() {
     component = Qt.createComponent(&quot;Sprite.qml&quot;);
     sprite = component.createObject(appWindow);

     if (sprite == null) {
         // Error Handling
         console.log(&quot;Error creating object&quot;);
     } else {
         sprite.x = 100;
         sprite.y = 100;
         // ...
     }
 }</pre>
<p>Notice in both instances, <a href="qml-component.html#createObject-method">createObject()</a> is called with <tt>appWindow</tt> passed as an argument so that the created object will become a child of the <tt>appWindow</tt> item in <tt>main.qml</tt>. Otherwise, the new item will not appear in the scene.</p>
<p>When using files with relative paths, the path should be relative to the file where <a href="qml-qt.html#createComponent-method">Qt.createComponent()</a> is executed.</p>
<a name="creating-an-object-from-a-string-of-qml"></a>
<h3>Creating an object from a string of QML</h3>
<p>If the QML is not defined until runtime, you can create a QML item from a string of QML using the <a href="qml-qt.html#createQmlObject-method">Qt.createQmlObject()</a> function, as in the following example:</p>
<pre class="highlightedCode brush: cpp"> var newObject = Qt.createQmlObject('import Qt 4.7; Rectangle {color: &quot;red&quot;; width: 20; height: 20}',
     parentItem, &quot;dynamicSnippet1&quot;);</pre>
<p>The first argument is the string of QML to create. Just like in a new file, you will need to import any types you wish to use. The second argument is the parent item for the new item; this should be an existing item in the scene. The third argument is the file path to associate with the new item; this is used for error reporting.</p>
<p>If the string of QML imports files using relative paths, the path should be relative to the file in which the parent item (the second argument to the method) is defined.</p>
<a name="maintaining-dynamically-created-objects"></a>
<h2>Maintaining Dynamically Created Objects</h2>
<p>When managing dynamically created items, you must ensure the creation context outlives the created item. Otherwise, if the creation context is destroyed first, the bindings in the dynamic item will no longer work.</p>
<p>The actual creation context depends on how an item is created:</p>
<ul>
<li>If <a href="qml-qt.html#createComponent-method">Qt.createComponent()</a> is used, the creation context is the <a href="qdeclarativecontext.html">QDeclarativeContext</a> in which this method is called</li>
<li>If <a href="qml-qt.html#createQmlObject-method">Qt.createQmlObject()</a> if called, the creation context is the context of the parent item passed to this method</li>
<li>If a <tt>Component{}</tt> item is defined and <a href="qml-component.html#createObject-method">createObject()</a> is called on that item, the creation context is the context in which the <tt>Component</tt> is defined</li>
</ul>
<p>Also, note that while dynamically created objects may be used the same as other objects, they do not have an id in QML.</p>
<a name="deleting-objects-dynamically"></a>
<h2>Deleting Objects Dynamically</h2>
<p>In many user interfaces, it is sufficient to set an item's opacity to 0 or to move the item off the screen instead of deleting the item. If you have lots of dynamically created items, however, you may receive a worthwhile performance benefit if unused items are deleted.</p>
<p>Note that you should never manually delete items that were dynamically created by QML elements (such as <a href="qml-loader.html">Loader</a> and <a href="qml-repeater.html">Repeater</a>). Also, you should avoid deleting items that you did not dynamically create yourself.</p>
<p>Items can be deleted using the <tt>destroy()</tt> method. This method has an optional argument (which defaults to 0) that specifies the approximate delay in milliseconds before the object is to be destroyed.</p>
<p>Here is an example. The <tt>application.qml</tt> creates five instances of the <tt>SelfDestroyingRect.qml</tt> component. Each instance runs a <a href="qml-numberanimation.html">NumberAnimation</a>, and when the animation has finished, calls <tt>destroy()</tt> on its root item to destroy itself:</p>
<table class="generic">
<tr class="odd topAlign"><td ><p><tt>application.qml</tt></p></td><td ><p><tt>SelfDestroyingRect.qml</tt></p></td></tr>
<tr class="even topAlign"><td ><p><pre class="highlightedCode brush: cpp"> import Qt 4.7

 Item {
     id: container
     width: 500; height: 100

     Component.onCompleted: {
         var component = Qt.createComponent(&quot;SelfDestroyingRect.qml&quot;);
         for (var i=0; i&lt;5; i++) {
             var object = component.createObject(container);
             object.x = (object.width + 10) * i;
         }
     }
 }</pre>
</p></td><td ><p><pre class="highlightedCode brush: cpp"> import Qt 4.7

 Rectangle {
     id: rect
     width: 80; height: 80
     color: &quot;red&quot;

     NumberAnimation on opacity {
         to: 0
         duration: 1000

         onRunningChanged: {
             if (!running) {
                 console.log(&quot;Destroying...&quot;)
                 rect.destroy();
             }
         }
     }
 }</pre>
</p></td></tr>
</table>
<p>Alternatively, the <tt>application.qml</tt> could have destroyed the created object by calling <tt>object.destroy()</tt>.</p>
<p>Notice that if a <tt>SelfDestroyingRect</tt> instance was created statically like this:</p>
<pre class="highlightedCode brush: cpp"> Item {
     SelfDestroyingRect { ... }
 }</pre>
<p>This would result in an error, since items can only be dynamically destroyed if they were dynamically created.</p>
<p>Objects created with <a href="qml-qt.html#createQmlObject-method">Qt.createQmlObject()</a> can similarly be destroyed using <tt>destroy()</tt>:</p>
<pre class="highlightedCode brush: cpp"> var newObject = Qt.createQmlObject('import Qt 4.7; Rectangle {color: &quot;red&quot;; width: 20; height: 20}',
     parentItem, &quot;dynamicSnippet1&quot;);
 newObject.destroy(1000);</pre>
</div>
<!-- @@@qdeclarativedynamicobjects.html -->
        <!-- /div -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback. <div class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</div></p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
  <!--/div -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4457116-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
