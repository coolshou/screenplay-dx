<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- addressbook-fr.qdoc -->
  <title>Qt 4.7: Carnet d'adresse 7 - Fonctionnalités avancées</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
		<div id="narrowsearch"><form onsubmit="return false;" action="" id="qtdocsearch">
		<fieldset>
		<input type="text" value="" id="pageType2" name="searchstring"/>
		 </fieldset>
		</form></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global stuff</a></li> 
			   <li><a href="qdeclarativeelements.html">QML elements</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Basic Qt architecture</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">Desktop UI components</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li><a href="examples-tutorials.html"></a></li>              <li>Carnet d'adresse 7 - Fonctionnalités avancées</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<div class="toc">
<h3><a name="toc">Contents</a></h3>
<ul>
<li class="level1"><a href="#d-finition-de-la-classe-addressbook">Définition de la classe AddressBook</a></li>
<li class="level1"><a href="#impl-mentation-de-la-classe-addressbook">Implémentation de la classe AddressBook</a></li>
</ul>
</div>
<h1 class="title">Carnet d'adresse 7 - Fonctionnalités avancées</h1>
<span class="subtitle"></span>
<!-- $$$tutorials/addressbook-fr/part7-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="tutorials-addressbook-fr-part7-addressbook-cpp.html">tutorials/addressbook-fr/part7/addressbook.cpp</a></li>
<li><a href="tutorials-addressbook-fr-part7-addressbook-h.html">tutorials/addressbook-fr/part7/addressbook.h</a></li>
<li><a href="tutorials-addressbook-fr-part7-finddialog-cpp.html">tutorials/addressbook-fr/part7/finddialog.cpp</a></li>
<li><a href="tutorials-addressbook-fr-part7-finddialog-h.html">tutorials/addressbook-fr/part7/finddialog.h</a></li>
<li><a href="tutorials-addressbook-fr-part7-main-cpp.html">tutorials/addressbook-fr/part7/main.cpp</a></li>
<li><a href="tutorials-addressbook-fr-part7-part7-pro.html">tutorials/addressbook-fr/part7/part7.pro</a></li>
</ul>
<p>Ce chapitre couvre quelques fonctionnalités additionnelles qui feront de notre carnet d'adresses une application plus pratique pour une utilisation quotidienne.</p>
<p class="centerAlign"><img src="images/addressbook-tutorial-part7-screenshot.png" /></p><p>Bien que notre application carnet d'adresses soit utile en tant que telle, il serait pratique de pouvoir échanger les contacts avec d'autres applications. Le format vCard est un un format de fichier populaire pour échanger ce type de données. Dans ce chapitre, nous étendrons notre carnet d'adresses pour permettre d'exporter des contacts dans des fichiers vCard <tt>.vcf</tt>.</p>
<a name="d-finition-de-la-classe-addressbook"></a>
<h2>Définition de la classe AddressBook</h2>
<p>Nous ajoutons un objet <a href="qpushbutton.html">QPushButton</a>, <tt>exportButton</tt>, et un slot public correspondant, <tt>exportAsVCard()</tt>, à notre classe <tt>AddressBook</tt> dans le fichier <tt>addressbook.h</tt>.</p>
<pre class="highlightedCode brush: cpp">     void exportAsVCard();
     ...
     QPushButton *exportButton;</pre>
<a name="impl-mentation-de-la-classe-addressbook"></a>
<h2>Implémentation de la classe AddressBook</h2>
<p>Dans le constructeur de <tt>AddressBook</tt>, nous connectons le signal <a href="qabstractbutton.html#clicked">clicked()</a> de <tt>exportButton</tt> au slot <tt>exportAsVCard()</tt>. Nous ajoutons aussi ce bouton à <tt>buttonLayout1</tt>, le layout responsable du groupe de boutons sur la droite.</p>
<p>Dans la méthode <tt>exportAsVCard()</tt>, nous commençons par extraire le nom du contact dans \n name. Nous déclarons <tt>firstname</tt>, <tt>lastName</tt> et <tt>nameList</tt>. Ensuite, nous cherchons la position du premier espace blanc de <tt>name</tt>. Si il y a un espace, nous séparons le nom du contact en <tt>firstName</tt> et <tt>lastName</tt>. Finalement, nous remplaçons l'espace par un underscore (&quot;<a href="index.html">_</a>&quot;). Si il n'y a pas d'espace, nous supposons que le contact ne comprend que le prénom.</p>
<pre class="highlightedCode brush: cpp"> void AddressBook::exportAsVCard()
 {
     QString name = nameLine-&gt;text();
     QString address = addressText-&gt;toPlainText();
     QString firstName;
     QString lastName;
     QStringList nameList;

     int index = name.indexOf(&quot; &quot;);

     if (index != -1) {
         nameList = name.split(QRegExp(&quot;\\s+&quot;), QString::SkipEmptyParts);
         firstName = nameList.first();
         lastName = nameList.last();
     } else {
         firstName = name;
         lastName = &quot;&quot;;
     }

     QString fileName = QFileDialog::getSaveFileName(this,
         tr(&quot;Export Contact&quot;), &quot;&quot;,
         tr(&quot;vCard Files (*.vcf);;All Files (*)&quot;));

     if (fileName.isEmpty())
         return;

     QFile file(fileName);</pre>
<p>Comme pour la méthode <tt>saveToFile()</tt>, nous ouvrons une boîte de dialogue pour donner la possibilité à l'utilisateur de choisir un emplacement pour le fichier. Avec le nom de fichier choisi, nous créons une instance de <a href="qfile.html">QFile</a> pour y écrire.</p>
<p>Nous essayons d'ouvrir le fichier en mode <a href="qiodevice.html#OpenModeFlag-enum">WriteOnly</a>. Si cela échoue, nous affichons un <a href="qmessagebox.html">QMessageBox</a> pour informer l'utilisateur à propos de l'origine du problème et nous quittons la méthode. Sinon, nous passons le fichier comme paramètre pour créer un objet <a href="qtextstream.html">QTextStream</a>, <tt>out</tt>. De la même façon que <a href="qdatastream.html">QDataStream</a>, la classe <a href="qtextstream.html">QTextStream</a> fournit les fonctionnalités pour lire et écrire des fichiers de texte. Grâce à celà, le fichier <tt>.vcf</tt> généré pourra être ouvert et édité à l'aide d'un simple éditeur de texte.</p>
<pre class="highlightedCode brush: cpp">     if (!file.open(QIODevice::WriteOnly)) {
         QMessageBox::information(this, tr(&quot;Unable to open file&quot;),
             file.errorString());
         return;
     }

     QTextStream out(&amp;file);</pre>
<p>Nous écrivons ensuite un fichier vCard avec la balise <tt>BEGIN:VCARD</tt>, suivit par <tt>VERSION:2.1</tt>. Le nom d'un contact est écrit à l'aide de la balise <tt>N:</tt>. Pour la balise <tt>FN:</tt>, qui remplit le titre du contact, nous devons vérifier si le contact à un nom de famille défini ou non. Si oui, nous utilions les détails de <tt>nameList</tt> pour remplir le champ, dans le cas contraire on écrit uniquement le contenu de <tt>firstName</tt>.</p>
<pre class="highlightedCode brush: cpp">     out &lt;&lt; &quot;BEGIN:VCARD&quot; &lt;&lt; &quot;\n&quot;;
     out &lt;&lt; &quot;VERSION:2.1&quot; &lt;&lt; &quot;\n&quot;;
     out &lt;&lt; &quot;N:&quot; &lt;&lt; lastName &lt;&lt; &quot;;&quot; &lt;&lt; firstName &lt;&lt; &quot;\n&quot;;

     if (!nameList.isEmpty())
        out &lt;&lt; &quot;FN:&quot; &lt;&lt; nameList.join(&quot; &quot;) &lt;&lt; &quot;\n&quot;;
     else
        out &lt;&lt; &quot;FN:&quot; &lt;&lt; firstName &lt;&lt; &quot;\n&quot;;</pre>
<p>Nous continuons en écrivant l'adresse du contact. Les points-virgules dans l'adresse sont échappés à l'aide de &quot;\&quot;, les retours de ligne sont remplacés par des points-virgules, et les vigules sont remplacées par des espaces. Finalement nous écrivons les balises <tt>ADR;HOME:;</tt> suivies par l'adresse et la balise <tt>END:VCARD</tt>.</p>
<pre class="highlightedCode brush: cpp">     address.replace(&quot;;&quot;, &quot;\\;&quot;, Qt::CaseInsensitive);
     address.replace(&quot;\n&quot;, &quot;;&quot;, Qt::CaseInsensitive);
     address.replace(&quot;,&quot;, &quot; &quot;, Qt::CaseInsensitive);

     out &lt;&lt; &quot;ADR;HOME:;&quot; &lt;&lt; address &lt;&lt; &quot;\n&quot;;
     out &lt;&lt; &quot;END:VCARD&quot; &lt;&lt; &quot;\n&quot;;

     QMessageBox::information(this, tr(&quot;Export Successful&quot;),
         tr(&quot;\&quot;%1\&quot; has been exported as a vCard.&quot;).arg(name));
 }</pre>
<p>À la fin de la méthode, un <a href="qmessagebox.html">QMessageBox</a> est affiché pour informer l'utilisateur que la vCard a été exportée avec succès.</p>
<p><i>vCard est une marque déposée de <a href="http://www.imc.org">Internet Mail Consortium</a></i>.</p>
</div>
<!-- @@@tutorials/addressbook-fr/part7 -->
        <!-- /div -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback. <div class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</div></p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
  <!--/div -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4457116-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
