<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en_US" lang="en_US">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<!-- extending-tutorial.qdoc -->
  <title>Qt 4.7: Chapter 1: Creating a New Type</title>
  <link rel="stylesheet" type="text/css" href="style/style.css" />
  <script src="scripts/jquery.js" type="text/javascript"></script>
  <script src="scripts/functions.js" type="text/javascript"></script>
</head>
<body class="offline narrow creator">
 <div class="header" id="qtdocheader">
    <div class="content"> 
    <div id="nav-logo">
      <a href="index.html">Home</a></div>
    <a href="index.html" class="qtref"><span>Qt Reference Documentation</span></a>
		<div id="narrowsearch"><form onsubmit="return false;" action="" id="qtdocsearch">
		<fieldset>
		<input type="text" value="" id="pageType2" name="searchstring"/>
		 </fieldset>
		</form></div>
    <div id="nav-topright">
      <ul>
        <li class="nav-topright-home"><a href="http://qt.nokia.com/">Qt HOME</a></li>
        <li class="nav-topright-dev"><a href="http://developer.qt.nokia.com/">DEV</a></li>
        <li class="nav-topright-labs"><a href="http://labs.qt.nokia.com/blogs/">LABS</a></li>
        <li class="nav-topright-doc nav-topright-doc-active"><a href="http://doc.qt.nokia.com/">
          DOC</a></li>
        <li class="nav-topright-blog"><a href="http://blog.qt.nokia.com/">BLOG</a></li>
      </ul>
    </div>
    <div id="shortCut">
      <ul>
        <li class="shortCut-topleft-inactive"><span><a href="index.html">Qt 4.7</a></span></li>
        <li class="shortCut-topleft-active"><a href="http://qt.nokia.com/doc/">ALL VERSIONS        </a></li>
      </ul>
     </div>
 <ul class="sf-menu sf-js-enabled sf-shadow" id="narrowmenu"> 
		 <li><a href="#">API Lookup</a> 
			 <ul id="topmenuLook"> 
			   <li><a href="classes.html">Class index</a></li> 
 			  <li><a href="functions.html">Function index</a></li> 
			   <li><a href="modules.html">Modules</a></li> 
			   <li><a href="namespaces.html">Namespaces</a></li> 
			   <li><a href="qtglobal.html">Global stuff</a></li> 
			   <li><a href="qdeclarativeelements.html">QML elements</a></li> 
			   </ul> 
		 </li> 
		 <li><a href="#">Qt Topics</a> 
			 <ul id="topmenuTopic"> 
			   <li><a href="qt-basic-concepts.html">Basic Qt architecture</a></li> 
			   <li><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li> 
			   <li><a href="qt-gui-concepts.html">Desktop UI components</a></li> 
			   <li><a href="platform-specific.html">Platform-specific info</a></li> 
			   <li><a href="best-practices.html">How-To's and Best Practices</a></li> 
			 </ul> 
		</li> 
		 <li><a href="#">Examples</a> 
			 <ul id="topmenuexample"> 
				 <li><a href="all-examples.html">Examples</a></li> 
				 <li><a href="tutorials.html">Tutorials</a></li> 
				 <li><a href="demos.html">Demos</a></li> 
				 <li><a href="qdeclarativeexamples.html">QML Examples</a></li> 
			 </ul> 
		 </li> 
 </ul> 
    </div>
  </div>
  <div class="wrapper">
    <div class="hd">
      <span></span>
    </div>
    <div class="bd group">
      <div class="sidebar">
        <div class="searchlabel">
          Search index:</div>
        <div class="search">
          <form id="qtdocsearch" action="" onsubmit="return false;">
            <fieldset>
              <input type="text" name="searchstring" id="pageType" value="" />
            </fieldset>
          </form>
        </div>
        <div class="box first bottombar" id="lookup">
          <h2 title="API Lookup"><span></span>
            API Lookup</h2>
          <div  id="list001" class="list">
          <ul id="ul001" >
              <li class="defaultLink"><a href="classes.html">Class index</a></li>
              <li class="defaultLink"><a href="functions.html">Function index</a></li>
              <li class="defaultLink"><a href="modules.html">Modules</a></li>
              <li class="defaultLink"><a href="namespaces.html">Namespaces</a></li>
              <li class="defaultLink"><a href="qtglobal.html">Global stuff</a></li>
              <li class="defaultLink"><a href="qdeclarativeelements.html">QML elements</a></li>
            </ul> 
          </div>
        </div>
        <div class="box bottombar" id="topics">
          <h2 title="Qt Topics"><span></span>
            Qt Topics</h2>
          <div id="list002" class="list">
            <ul id="ul002" >
              <li class="defaultLink"><a href="qt-basic-concepts.html">Basic Qt architecture</a></li>
              <li class="defaultLink"><a href="qtquick.html">Device UI's &amp; Qt Quick</a></li>
              <li class="defaultLink"><a href="qt-gui-concepts.html">Desktop UI components</a></li>
              <li class="defaultLink"><a href="platform-specific.html">Platform-specific info</a></li>
            </ul>  
          </div>
        </div>
        <div class="box" id="examples">
          <h2 title="Examples"><span></span>
            Examples</h2>
          <div id="list003" class="list">
        <ul id="ul003">
              <li class="defaultLink"><a href="all-examples.html">Examples</a></li>
              <li class="defaultLink"><a href="tutorials.html">Tutorials</a></li>
              <li class="defaultLink"><a href="demos.html">Demos</a></li>
              <li class="defaultLink"><a href="qdeclarativeexamples.html">QML Examples</a></li>
            </ul> 
          </div>
        </div>
      </div>
      <div class="wrap">
        <div class="toolbar">
          <div class="breadcrumb toolblock">
            <ul>
              <li class="first"><a href="index.html">Home</a></li>
              <!--  Bread crumbs goes here -->
              <li><a href="all-examples.html">Examples</a></li>              <li><a href="qdeclarativeexamples.html">QML Examples &amp; Demos</a></li>              <li>Chapter 1: Creating a New Type</li>            </ul>
          </div>
          <div class="toolbuttons toolblock">
            <ul>
              <li id="smallA" class="t_button">A</li>
              <li id="medA" class="t_button active">A</li>
              <li id="bigA" class="t_button">A</li>
              <li id="print" class="t_button"><a href="javascript:this.print();">
                <span>Print</span></a></li>
            </ul>
          </div>
        </div>
        <div class="content">
<h1 class="title">Chapter 1: Creating a New Type</h1>
<span class="subtitle"></span>
<!-- $$$declarative/tutorials/extending/chapter1-basics-description -->
<div class="descr"> <a name="details"></a>
<p>Files:</p>
<ul>
<li><a href="declarative-tutorials-extending-chapter1-basics-app-qml.html">declarative/tutorials/extending/chapter1-basics/app.qml</a></li>
<li><a href="declarative-tutorials-extending-chapter1-basics-piechart-cpp.html">declarative/tutorials/extending/chapter1-basics/piechart.cpp</a></li>
<li><a href="declarative-tutorials-extending-chapter1-basics-piechart-h.html">declarative/tutorials/extending/chapter1-basics/piechart.h</a></li>
<li><a href="declarative-tutorials-extending-chapter1-basics-main-cpp.html">declarative/tutorials/extending/chapter1-basics/main.cpp</a></li>
<li><a href="declarative-tutorials-extending-chapter1-basics-chapter1-basics-pro.html">declarative/tutorials/extending/chapter1-basics/chapter1-basics.pro</a></li>
</ul>
<p>A common task when extending QML is to provide a new QML type that supports some custom functionality beyond what is provided by the built-in <a href="qdeclarativeelements.html">QML Elements</a>. For example, this could be done to implement particular data models, or provide elements with custom painting and drawing capabilities, or access system features like network programming that are not accessible through built-in QML features.</p>
<p>In this tutorial, we will show how to use the C++ classes in the <a href="qtdeclarative.html">QtDeclarative</a> module to extend QML. The end result will be a simple Pie Chart display implemented by several custom QML types connected together through QML features like bindings and signals, and made available to the QML runtime through a plugin.</p>
<p>To begin with, let's create a new QML type called &quot;PieChart&quot; that has two properties: a name and a color. We will make it available in a <a href="qdeclarativemodules.html">module</a> called &quot;Charts&quot;, with a module version of 1.0&#x2e;</p>
<p>We want this <tt>PieChart</tt> type to be usable from QML like this:</p>
<pre class="highlightedCode brush: cpp"> import Charts 1.0

 PieChart {
     width: 100; height: 100
     name: &quot;A simple pie chart&quot;
     color: &quot;red&quot;
 }</pre>
<p>To do this, we need a C++ class that encapsulates this <tt>PieChart</tt> type and its two properties. Since QML makes extensive use of Qt's <a href="metaobjects.html#meta-object-system">meta object system</a>, this new class must:</p>
<ul>
<li>Inherit from <a href="qobject.html">QObject</a></li>
<li>Declare its properties using the Q_PROPERTY macro</li>
</ul>
<p>Here is our <tt>PieChart</tt> class, defined in <tt>piechart.h</tt>:</p>
<pre class="highlightedCode brush: cpp"> #include &lt;QDeclarativeItem&gt;
 #include &lt;QColor&gt;

 class PieChart : public QDeclarativeItem
 {
     Q_OBJECT
     Q_PROPERTY(QString name READ name WRITE setName)
     Q_PROPERTY(QColor color READ color WRITE setColor)

 public:
     PieChart(QDeclarativeItem *parent = 0);

     QString name() const;
     void setName(const QString &amp;name);

     QColor color() const;
     void setColor(const QColor &amp;color);

     void paint(QPainter *painter, const QStyleOptionGraphicsItem *option, QWidget *widget = 0);

 private:
     QString m_name;
     QColor m_color;
 };</pre>
<p>The class inherits from <a href="qdeclarativeitem.html">QDeclarativeItem</a> because we want to override <a href="qgraphicsitem.html#paint">QDeclarativeItem::paint</a>() in order to draw. If the class just represented some data type and was not an item that actually needed to be displayed, it could simply inherit from <a href="qobject.html">QObject</a>. Or, if we want to extend the functionality of an existing <a href="qobject.html">QObject</a>-based class, it could inherit from that class instead.</p>
<p>The <tt>PieChart</tt> class defines the two properties, <tt>name</tt> and <tt>color</tt>, with the Q_PROPERTY macro, and overrides <a href="qgraphicsitem.html#paint">QDeclarativeItem::paint</a>(). The class implementation in <tt>piechart.cpp</tt> simply sets and returns the <tt>m_name</tt> and <tt>m_color</tt> values as appropriate, and implements <tt>paint()</tt> to draw a simple pie chart. It also turns off the <a href="qgraphicsitem.html#GraphicsItemFlag-enum">QGraphicsItem::ItemHasNoContents</a> flag to enable painting:</p>
<pre class="highlightedCode brush: cpp"> PieChart::PieChart(QDeclarativeItem *parent)
     : QDeclarativeItem(parent)
 {
     <span class="comment">// need to disable this flag to draw inside a QDeclarativeItem</span>
     setFlag(QGraphicsItem::ItemHasNoContents, false);
 }
 ...
 void PieChart::paint(QPainter *painter, const QStyleOptionGraphicsItem *, QWidget *)
 {
     QPen pen(m_color, 2);
     painter-&gt;setPen(pen);
     painter-&gt;setRenderHints(QPainter::Antialiasing, true);
     painter-&gt;drawPie(boundingRect(), 90 * 16, 290 * 16);
 }</pre>
<p>Now that we have defined the <tt>PieChart</tt> type, we will use it from QML. The <tt>app.qml</tt> file creates a <tt>PieChart</tt> item and display the pie chart's details using a standard QML <a href="qml-text.html">Text</a> item:</p>
<pre class="highlightedCode brush: cpp"> import Charts 1.0
 import Qt 4.7

 Item {
     width: 300; height: 200

     PieChart {
         id: aPieChart
         anchors.centerIn: parent
         width: 100; height: 100
         name: &quot;A simple pie chart&quot;
         color: &quot;red&quot;
     }

     Text {
         anchors { bottom: parent.bottom; horizontalCenter: parent.horizontalCenter; bottomMargin: 20 }
         text: aPieChart.name
     }
 }</pre>
<p>Notice that although the color is specified as a string in QML, it is automatically converted to a <a href="qcolor.html">QColor</a> object for the PieChart <tt>color</tt> property. Automatic conversions are provided for various other <a href="qdeclarativebasictypes.html">basic types</a>; for example, a string like &quot;640x480&quot; can be automatically converted to a <a href="qsize.html">QSize</a> value.</p>
<p>We'll also create a C++ application that uses a <a href="qdeclarativeview.html">QDeclarativeView</a> to run and display <tt>app.qml</tt>. The application must register the <tt>PieChart</tt> type using the <a href="qdeclarativeengine.html#qmlRegisterType">qmlRegisterType</a>() function, to allow it to be used from QML. If you don't register the type, <tt>app.qml</tt> won't be able to create a <tt>PieChart</tt>.</p>
<p>Here is the application <tt>main.cpp</tt>:</p>
<pre class="highlightedCode brush: cpp"> #include &quot;piechart.h&quot;
 #include &lt;qdeclarative.h&gt;
 #include &lt;QDeclarativeView&gt;
 #include &lt;QApplication&gt;

 int main(int argc, char *argv[])
 {
     QApplication app(argc, argv);

     qmlRegisterType&lt;PieChart&gt;(&quot;Charts&quot;, 1, 0, &quot;PieChart&quot;);

     QDeclarativeView view;
     view.setSource(QUrl::fromLocalFile(&quot;app.qml&quot;));
     view.show();
     return app.exec();
 }</pre>
<p>This call to <a href="qdeclarativeengine.html#qmlRegisterType">qmlRegisterType</a>() registers the <tt>PieChart</tt> type as a type called &quot;PieChart&quot;, in a module named &quot;Charts&quot;, with a module version of 1.0&#x2e;</p>
<p>Lastly, we write a <tt>.pro</tt> project file that includes the files and the <tt>declarative</tt> library:</p>
<pre class="highlightedCode brush: cpp"> QT += declarative

 HEADERS += piechart.h
 SOURCES += piechart.cpp \
            main.cpp</pre>
<p>Now we can build and run the application:</p>
<p class="centerAlign"><img src="images/extending-tutorial-chapter1.png" /></p><p>Try it yourself with the code in Qt's <tt>examples/tutorials/extending/chapter1-basics</tt> directory.</p>
<p>At the moment, the <tt>app.qml</tt> is run from within a C++ application. This may seem odd if you're used to running QML files with the <a href="qmlviewer.html">QML Viewer</a>. Later on, we'll show how to create a plugin so that you can run <tt>app.qml</tt> using the <a href="qmlviewer.html">QML Viewer</a> instead.</p>
</div>
<!-- @@@declarative/tutorials/extending/chapter1-basics -->
        <!-- /div -->
        <div class="feedback t_button">
          [+] Documentation Feedback</div>
      </div>
    </div>
    <div class="ft">
      <span></span>
    </div>
  </div> 
  <div class="footer">
    <p>
      <acronym title="Copyright">&copy;</acronym> 2008-2010 Nokia Corporation and/or its
      subsidiaries. Nokia, Qt and their respective logos are trademarks of Nokia Corporation 
      in Finland and/or other countries worldwide.</p>
    <p>
      All other trademarks are property of their respective owners. <a title="Privacy Policy"
        href="http://qt.nokia.com/about/privacy-policy">Privacy Policy</a></p>
  </div>
  <div id="feedbackBox">
      <div id="feedcloseX" class="feedclose t_button">X</div>
    <form id="feedform" action="http://doc.qt.nokia.com/docFeedbck/feedback.php" method="get">
      <p id="noteHead">Thank you for giving your feedback. <div class="note">Make sure it is related to this specific page. For more general bugs and 
      requests, please use the <a href="http://bugreports.qt.nokia.com/secure/Dashboard.jspa">Qt Bug Tracker</a>.</div></p>
      <p><textarea id="feedbox" name="feedText" rows="5" cols="40"></textarea></p>
      <p><input id="feedsubmit" class="feedclose" type="submit" name="feedback" /></p>
    </form>
  </div>
  <div id="blurpage">
  </div>
  <!--/div -->
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-4457116-5']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</body>
</html>
